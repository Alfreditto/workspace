package prueba;

import java.io.*;

public class Examen1 {

	public static void main(String args[]) throws IOException {
		File fichero = new File("libros.dat");

		// Podría haber muchos más libros - Utilizaremos el ISBN para como código único
		// para obtener la dirección física dónde guardarlo:
		int isbn[] = { 23, 1, 10, 13, 15, 4, 30, 20, 25, 12 };

		// Cada TITULO ocupará 40 caracteres:
		String titulo[] = { "La casa de los espíritus", "La novia gitana", "Amanece que no es poco",
				"El clan del oso cavernario", "Paula", "Viven", "Los pilares de la tierra",
				"Los renglones torcidos de Dios", "La piel del tambor", "El juego del ángel" };

		// Número de EJEMPLARES que tenemos de cada libro:
		int ejemplares[] = { 1, 2, 8, 2, 1, 3, 5, 1, 1, 4 };

		// Precio de cada libro:
		double precio[] = { 50, 27.5, 12, 38, 20, 10.5, 6.5, 25, 20, 15 };

		// A partir de aquí empieza la solución del alumno.
		StringBuffer tituloBuf = null;
		// Recorremos los ISBN
		for (int i = 0; i < isbn.length; i++) {
			// Calculamos la posicion del puntero segun el ISBN y nos colocamos ahí.
			long posicion = (isbn[i] - 1) * 96;
			file.seek(posicion);
			// Escribimos el ISBN.
			file.writeInt(isbn[i]);
			// Hacemos que el Titulo ocupe 40 caracteres y lo escribimos.
			tituloBuf = new StringBuffer(titulo[i]);
			tituloBuf.setLength(40);
			file.writeChars(tituloBuf.toString());
			// Escribimos el numero de ejemplares
			file.writeInt(ejemplares[i]);
			// Escribimos el precio del libro
			file.writeDouble(precio[i]);

		}
		file.close();
		RandomAccessFile fileLect = new RandomAccessFile(fichero, "r");

		// Lectura
		fileLect.seek(0);
		int isbnAux = 0;
		char[] tituloAux = new char[40];
		int ejemplaresAux = 0;
		double precioAux = 0.00;
		System.out.println("Tamaño en bytes del fichero: " + fileLect.length());
		while (fileLect.getFilePointer() < fileLect.length()) {
			isbnAux = fileLect.readInt();

			for (int i = 0; i < tituloAux.length; i++) {
				tituloAux[i] = fileLect.readChar();
			}

			String tituloStr = new String(tituloAux);

			ejemplaresAux = fileLect.readInt();

			precioAux = fileLect.readDouble();
			if (isbnAux != 0) {
				System.out.println("Comienzo del registro: " + fileLect.getFilePointer() + "-> ISBN: " + isbnAux
						+ ", Título: " + tituloStr + ", Ejemplares: " + ejemplaresAux + ", Precio: " + precioAux);
			}
		}

		fileLect.close();

	}

}
