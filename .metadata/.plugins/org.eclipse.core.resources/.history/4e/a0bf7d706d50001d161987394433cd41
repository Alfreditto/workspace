package prueba;

import org.w3c.dom.*;
import javax.xml.parsers.*;
import javax.xml.transform.*;
import javax.xml.transform.dom.*;
import javax.xml.transform.stream.*;
import java.io.*;

public class Examen3 {
	public static void main(String[] args) throws IOException {
		RandomAccessFile file = new RandomAccessFile(new File("libros.xml"), "r");
		int isbnAux = 0;
		char[] tituloAux = new char[40];
		int ejemplaresAux = 0;
		double precioAux = 0.00;

		int posicion = 0;
		DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
		try {
			DocumentBuilder builder = factory.newDocumentBuilder();
			DOMImplementation implementation = builder.getDOMImplementation();
			Document document = implementation.createDocument(null, "Empleados", null);
			document.setXmlVersion("1.0");
			for (;;) {
				file.seek(posicion);
				isbnAux = file.readInt();

				for (int i = 0; i < tituloAux.length; i++) {
					tituloAux[i] = file.readChar();
				}

				String tituloStr = new String(tituloAux);

				ejemplaresAux = file.readInt();

				precioAux = file.readDouble();

				if (isbnAux > 0) {
					Element raiz = document.createElement("libro");
					document.getDocumentElement().appendChild(raiz);
					CrearElemento("isbn", Integer.toString(isbnAux), raiz, document);
					CrearElemento("titulo", tituloStr.trim(), raiz, document);
					CrearElemento("ejemplares", Integer.toString(ejemplaresAux), raiz, document);
					CrearElemento("precio", Double.toString(precioAux), raiz, document);
				}
				posicion += 96;
				if (file.getFilePointer() == file.length())
					break;
			}
			Source source = new DOMSource(document);
			Result result = new StreamResult(new java.io.File("libros.xml"));
			Transformer transformer = TransformerFactory.newInstance().newTransformer();
			transformer.transform(source, result);
		} catch (Exception e) {
			System.out.println("Error " + e);
		}
		file.close();
	}

	public static void CrearElemento(String datoEmple, String valor, Element raiz, Document document) {
		Element elem = document.createElement(datoEmple);
		Text text = document.createTextNode(valor);
		raiz.appendChild(elem);
		elem.appendChild(text);
	}

}
